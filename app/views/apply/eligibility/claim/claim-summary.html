{% extends "includes/layout.html" %}

{% block page_title %}
  {% if serviceName %} {{ serviceName }} {% endif %}
{% endblock %}

{% block content %}

<main id="content" role="main">

  {% include "includes/phase_banner_beta.html" %}

  {% include "includes/validation-error-messages.html" %}

  <h2 class="heading-large">
    Your claim details
  </h2>

  <p>Please add the relevant documentation associated with your claim.</p>

  <table class="col-2">
    <tr>
      <td>Visitor</td>
      <td>{{ claimDetails.claim['FirstName'] }} {{ claimDetails.claim['LastName'] }}</td>
    </tr>

    {% for child in claimDetails.claimChild %}
    <tr>
      <td>Child</td>
      <td>{{ child['Name'] }}</td>
    </tr>
    {% endfor %}

    <tr id='benefit-information'{% if errors['benefit-information'][0] %} class="warning" {% endif %}>
      <td>Benefit information</td>
      <td>
        {{ benefitsEnum[claimDetails.claim['Benefit']].displayName }}

        {% if benefitsEnum[claimDetails.claim['Benefit']].requireBenefitUpload %}
          <br>
          {% if claimDetails.claim['benefitDocument'][0]['DocumentStatus'] == 'uploaded' %}
            {% if benefitsEnum[claimDetails.claim['Benefit']].multipage %}
            <ul class="list doc-upload">
              {% for benefit in claimDetails.claim['benefitDocument'] %}
                <li>
                  <span class="text-success">Benefit documentation uploaded</span>
                  <form
                    action="/apply/{{ claimType }}/eligibility/{{ referenceId }}/claim/{{ claimId }}/summary/view-document/{{ benefit['ClaimDocumentId'] }}"
                    method="get" class="form pull-right">
                    <input type="hidden" name="_csrf" value="{{ csrfToken }}">
                    <button class="link">view</button>
                  </form>
                  <span class="button-separator"></span>
                  <form
                    action="/apply/{{ claimType }}/eligibility/{{ referenceId }}/claim/{{ claimId }}/summary/remove-document/{{ benefit['ClaimDocumentId'] }}?document={{ claimDetails.claim['Benefit'] }}"
                    method="post" class="form pull-right">
                    <input type="hidden" name="_csrf" value="{{ csrfToken }}">
                    <button class="link" name="remove">remove</button>
                  </form>
                </li>
              {% endfor %}
              <li><a href="/apply/{{ claimType }}/eligibility/{{ referenceId }}/claim/{{ claimId }}/file-upload?document={{ claimDetails.claim['Benefit'] }}&hideAlt=true" id="add-benefit" class="button grey pull-right">Add another page</a></li>
            </ul>
            {% else %}
              <span class="text-success">Benefit documentation uploaded</span>
              <form
                action="/apply/{{ claimType }}/eligibility/{{ referenceId }}/claim/{{ claimId }}/summary/view-document/{{ claimDetails.claim.benefitDocument[0]['ClaimDocumentId'] }}"
                method="get" class="form pull-right">
                <input type="hidden" name="_csrf" value="{{ csrfToken }}">
                <button class="link">view</button>
              </form>
              <span class="button-separator"></span>
              <form
                action="/apply/{{ claimType }}/eligibility/{{ referenceId }}/claim/{{ claimId }}/summary/remove-document/{{ claimDetails.claim.benefitDocument[0]['ClaimDocumentId'] }}?document={{ claimDetails.claim['Benefit'] }}"
                method="post" class="form pull-right">
                <input type="hidden" name="_csrf" value="{{ csrfToken }}">
                <button class="remove link" name="remove">remove</button>
              </form>
            {% endif %}
          {% elif claimDetails.claim['benefitDocument'][0]['DocumentStatus'] == 'upload-later' %}
            <span class="text-pending">Uploading benefit documentation later</span>
            <form
              action="/apply/{{ claimType }}/eligibility/{{ referenceId }}/claim/{{ claimId }}/summary/remove-document/{{ claimDetails.claim.benefitDocument[0].ClaimDocumentId }}?document={{ claimDetails.claim['Benefit'] }}"
              method="post" class="form pull-right">
              <input type="hidden" name="_csrf" value="{{ csrfToken }}">
              <button class="link" name="change" id="change-{{ claimDetails.claim['Benefit'] }}-upload-later">change</button>
            </form>
          {% elif claimDetails.claim['benefitDocument'][0]['DocumentStatus'] == 'post-later' %}
            <span class="text-pending">Sending benefit documentation by post</span>
            <form
              action="/apply/{{ claimType }}/eligibility/{{ referenceId }}/claim/{{ claimId }}/summary/remove-document/{{ claimDetails.claim.benefitDocument[0].ClaimDocumentId }}?document={{ claimDetails.claim['Benefit'] }}"
              method="post" class="form pull-right">
              <input type="hidden" name="_csrf" value="{{ csrfToken }}">
              <button class="link" name="change" id="change-{{ claimDetails.claim['Benefit'] }}-post">change</button>
            </form>
          {% else %}
            <span class="text-warning">Benefit documentation required</span>
            <a href="/apply/{{ claimType }}/eligibility/{{ referenceId }}/claim/{{ claimId }}/file-upload?document={{ claimDetails.claim['Benefit'] }}" id="add-benefit" class="button grey pull-right">Add</a>
          {% endif %}
        {% endif %}
      </td>
    </tr>


  </table>

  <h2 class="heading-medium">Your visit</h2>

  <table class="col-2">

    <tr>
      <td>Prisoner name</td>
      <td>{{ claimDetails.claim['PrisonerFirstName']}} {{ claimDetails.claim['PrisonerLastName'] }}</td>
    </tr>

    <tr>
      <td>Prisoner number</td>
      <td>{{ claimDetails.claim['PrisonNumber'] }}</td>
    </tr>

    <tr>
      <td>Prison</td>
      <td>{{ claimDetails.claim['NameOfPrison'] }}</td>
    </tr>

    <tr>
      <td>Date of visit</td>
      <td>{{ dateHelper(claimDetails.claim['DateOfJourney']) }}</td>
    </tr>

    <tr id="VisitConfirmation" {% if errors['VisitConfirmation'][0] %} class="warning" {% endif %}>
      <td>Visit confirmation</td>
      <td>
        {% if claimDetails.claim.visitConfirmation['DocumentStatus'] == 'uploaded' %}
          <span class="text-success">Visit confirmation uploaded</span>
          <form
            action="/apply/{{ claimType }}/eligibility/{{ referenceId }}/claim/{{ claimId }}/summary/view-document/{{ claimDetails.claim.visitConfirmation.ClaimDocumentId }}"
            method="get" class="form pull-right">
            <input type="hidden" name="_csrf" value="{{ csrfToken }}">
            <button class="link">view</button>
          </form>
          <span class="button-separator"></span>
          <form
            action="/apply/{{ claimType }}/eligibility/{{ referenceId }}/claim/{{ claimId }}/summary/remove-document/{{ claimDetails.claim.visitConfirmation['ClaimDocumentId'] }}?document=VISIT_CONFIRMATION"
            method="post" class="form pull-right">
            <input type="hidden" name="_csrf" value="{{ csrfToken }}">
            <button class="link" name="remove">remove</button>
          </form>
        {% elif claimDetails.claim.visitConfirmation['DocumentStatus'] == 'upload-later' %}
          <span class="text-pending">Uploading visit confirmation later</span>
          <form
            action="/apply/{{ claimType }}/eligibility/{{ referenceId }}/claim/{{ claimId }}/summary/remove-document/{{ claimDetails.claim.visitConfirmation.ClaimDocumentId }}?document=VISIT_CONFIRMATION"
            method="post" class="form pull-right">
            <input type="hidden" name="_csrf" value="{{ csrfToken }}">
            <button class="link" name="change" id="change-visit-confirmation-upload-later">change</button>
          </form>
        {% elif claimDetails.claim.visitConfirmation['DocumentStatus'] == 'post-later' %}
          <span class="text-pending">Sending visit confirmation by post</span>
          <form
            action="/apply/{{ claimType }}/eligibility/{{ referenceId }}/claim/{{ claimId }}/summary/remove-document/{{ claimDetails.claim.visitConfirmation.ClaimDocumentId }}?document=VISIT_CONFIRMATION"
            method="post" class="form pull-right">
            <input type="hidden" name="_csrf" value="{{ csrfToken }}">
            <button class="link" name="change" id="change-visit-confirmation-post">change</button>
          </form>
        {% else %}
          <span class="text-warning">Visit confirmation required</span>
          <a href="/apply/{{ claimType }}/eligibility/{{ referenceId }}/claim/{{ claimId }}/file-upload?document=VISIT_CONFIRMATION" id="add-visit-confirmation" class="button grey pull-right">Add</a>
        {% endif %}
      </td>
    </tr>

  </table>

  <br>

  <table>

    <thead>
    <tr>
      <th>Expense(s)</th>
      <th>Amount</th>
      <th></th>
    </tr>
    </thead>

    <tbody>
    {% for claimExpense in claimDetails.claimExpenses %}
    <tr>
      <td>
        <span class="bold">{{ claimExpenseHelper.DisplayName(claimExpense) }} </span>
        <div>{{ claimExpenseHelper.FormattedDetail(claimExpense) }}</div>
        <form
          action="/apply/{{ claimType }}/eligibility/{{ referenceId }}/claim/{{ claimId }}/summary/remove-expense/{{ claimExpense.ClaimExpenseId}}"
          method="post" class="form">
          <input type="hidden" name="_csrf" value="{{ csrfToken }}">
          <button class="expense link" name="remove">remove</button>
        </form>
      </td>
      <td>Â£{{claimExpense.Cost}}</td>
      <td><span class="text-warning">Receipt required</span></td>
    </tr>
    {% endfor %}
    </tbody>

  </table>

  <br>
  <a href="/apply/{{ claimType }}/eligibility/{{ referenceId }}/claim/{{ claimId }}" class="link">Add another expense</a>

  <br>
  <br>
  <br>

  <form action="/apply/{{ claimType }}/eligibility/{{ referenceId }}/claim/{{ claimId }}/summary" method="post" class="form">

    <div class="form-group">
      {% include "partials/csrf-hidden-input.html" %}

      <input id="claim-summary-submit"
             type="submit"
             value="Continue"
             class="button">
    </div>

  </form>

</main>

{% endblock %}
